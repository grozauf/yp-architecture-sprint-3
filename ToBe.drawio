<mxfile host="Electron" modified="2024-09-11T15:48:23.605Z" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/24.6.4 Chrome/124.0.6367.207 Electron/30.0.6 Safari/537.36" etag="_YHHQwscasOvsbLz3ypy" version="24.6.4" type="device">
  <diagram name="Page-1" id="UsNW1CG11SA1kaQBIMI0">
    <mxGraphModel dx="11346" dy="9845" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="80HF06romhgn_pdEOzrI-25" value="" style="sketch=0;pointerEvents=1;shadow=0;dashed=0;html=1;strokeColor=none;labelPosition=center;verticalLabelPosition=bottom;verticalAlign=top;outlineConnect=0;align=center;shape=mxgraph.office.concepts.home;fillColor=#CCCBCB;" parent="1" vertex="1">
          <mxGeometry x="4040" y="1700" width="360" height="280" as="geometry" />
        </mxCell>
        <mxCell id="80HF06romhgn_pdEOzrI-31" value="IoT" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4070" y="1930" width="90" height="60" as="geometry" />
        </mxCell>
        <mxCell id="80HF06romhgn_pdEOzrI-47" value="IoT" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4175" y="1930" width="90" height="60" as="geometry" />
        </mxCell>
        <mxCell id="80HF06romhgn_pdEOzrI-48" value="IoT" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4290" y="1930" width="90" height="60" as="geometry" />
        </mxCell>
        <mxCell id="80HF06romhgn_pdEOzrI-52" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.019;exitY=0.55;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="byD6cdz-UoJXL5TT6-PQ-8" target="80HF06romhgn_pdEOzrI-31" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="4198.25" y="1829.9565217391305" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="4115" y="1824" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="80HF06romhgn_pdEOzrI-55" value="SYNC" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="80HF06romhgn_pdEOzrI-52" vertex="1" connectable="0">
          <mxGeometry x="0.6378" y="2" relative="1" as="geometry">
            <mxPoint x="-2" y="-6" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="80HF06romhgn_pdEOzrI-53" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="byD6cdz-UoJXL5TT6-PQ-8" target="80HF06romhgn_pdEOzrI-47" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="4220" y="1870" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="4220" y="1880" />
              <mxPoint x="4220" y="1880" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="80HF06romhgn_pdEOzrI-57" value="SYNC" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="80HF06romhgn_pdEOzrI-53" vertex="1" connectable="0">
          <mxGeometry x="0.2353" relative="1" as="geometry">
            <mxPoint y="-14" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="80HF06romhgn_pdEOzrI-54" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0;exitDx=120;exitDy=50;exitPerimeter=0;" parent="1" source="byD6cdz-UoJXL5TT6-PQ-8" target="80HF06romhgn_pdEOzrI-48" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="4241.749999999999" y="1829.9565217391305" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="80HF06romhgn_pdEOzrI-58" value="SYNC" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="80HF06romhgn_pdEOzrI-54" vertex="1" connectable="0">
          <mxGeometry x="0.6565" y="1" relative="1" as="geometry">
            <mxPoint x="-1" y="-7" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="80HF06romhgn_pdEOzrI-59" value="" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;fillColor=#8C4FFF;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.managed_streaming_for_kafka;" parent="1" vertex="1">
          <mxGeometry x="4450" y="500" width="210" height="210" as="geometry" />
        </mxCell>
        <mxCell id="80HF06romhgn_pdEOzrI-60" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="byD6cdz-UoJXL5TT6-PQ-8" target="byD6cdz-UoJXL5TT6-PQ-37" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="4060" y="840" as="sourcePoint" />
            <mxPoint x="4494.96" y="709.9999999999998" as="targetPoint" />
            <Array as="points">
              <mxPoint x="4210" y="1520" />
              <mxPoint x="4210" y="1520" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="80HF06romhgn_pdEOzrI-61" value="ASYNC отправка показателей&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;1. Событие об изменении целевого значения&lt;/b&gt;:&lt;/div&gt;&lt;div&gt;id дома&lt;/div&gt;&lt;div&gt;id счётчика&lt;/div&gt;&lt;div&gt;значение&lt;/div&gt;&lt;div&gt;актор - кто изменил целевое значение&lt;/div&gt;&lt;div&gt;время изменения значения&amp;nbsp;&lt;/div&gt;&lt;div&gt;(админ, пользователь, сценарий)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;2. Событие об изменении текущего значения&lt;/b&gt;:&lt;/div&gt;&lt;div&gt;id дома&lt;/div&gt;&lt;div&gt;id счётчика&lt;/div&gt;&lt;div&gt;значение&lt;/div&gt;&lt;div&gt;время изменения значения&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="80HF06romhgn_pdEOzrI-60" vertex="1" connectable="0">
          <mxGeometry x="-0.0047" y="3" relative="1" as="geometry">
            <mxPoint x="3" y="-185" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="80HF06romhgn_pdEOzrI-65" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="80HF06romhgn_pdEOzrI-62" target="80HF06romhgn_pdEOzrI-59" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4490" y="310" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="80HF06romhgn_pdEOzrI-66" value="ASYNC получение показателей&lt;div&gt;- текущего значения&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="80HF06romhgn_pdEOzrI-65" vertex="1" connectable="0">
          <mxGeometry x="-0.2992" y="3" relative="1" as="geometry">
            <mxPoint x="-15" y="3" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="80HF06romhgn_pdEOzrI-62" value="Сервис телеметрии" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3940" y="260" width="250" height="100" as="geometry" />
        </mxCell>
        <mxCell id="80HF06romhgn_pdEOzrI-67" value="&lt;font style=&quot;font-size: 17px;&quot;&gt;Clickhouse&lt;/font&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.database;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="4100" y="320" width="130" height="130" as="geometry" />
        </mxCell>
        <mxCell id="80HF06romhgn_pdEOzrI-69" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="80HF06romhgn_pdEOzrI-68" target="80HF06romhgn_pdEOzrI-62" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="80HF06romhgn_pdEOzrI-70" value="Синхронное получения значений" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="80HF06romhgn_pdEOzrI-69" vertex="1" connectable="0">
          <mxGeometry x="-0.0148" y="3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="80HF06romhgn_pdEOzrI-68" value="Сервис мониторинга" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3940" y="-120" width="250" height="100" as="geometry" />
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="80HF06romhgn_pdEOzrI-71" target="byD6cdz-UoJXL5TT6-PQ-41" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="3840" y="950" as="targetPoint" />
            <Array as="points">
              <mxPoint x="3675" y="360" />
              <mxPoint x="3570" y="360" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-11" value="Сообщает, что должен&amp;nbsp;&lt;div&gt;сделать блок управления&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="byD6cdz-UoJXL5TT6-PQ-7" vertex="1" connectable="0">
          <mxGeometry x="-0.4068" y="2" relative="1" as="geometry">
            <mxPoint y="-1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="80HF06romhgn_pdEOzrI-71" target="80HF06romhgn_pdEOzrI-73" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-13" value="Получить информацию о&amp;nbsp;&lt;div&gt;зарегистрированном&amp;nbsp;&lt;/div&gt;&lt;div&gt;устройстве&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="byD6cdz-UoJXL5TT6-PQ-9" vertex="1" connectable="0">
          <mxGeometry x="0.0169" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="80HF06romhgn_pdEOzrI-71" value="Сервис управления умным домом" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3550" y="-120" width="250" height="100" as="geometry" />
        </mxCell>
        <mxCell id="saPh2kpJ-CRyQlsd_s0C-8" value="Получить данные по добавленным коробкам и устройствам&lt;div&gt;, которыми она управляет&lt;/div&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=classic;startFill=1;endArrow=none;endFill=0;" edge="1" parent="1" source="80HF06romhgn_pdEOzrI-73" target="80HF06romhgn_pdEOzrI-74">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3130" y="-610" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="80HF06romhgn_pdEOzrI-73" value="Сервис регистрации устройств" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3040" y="-120" width="250" height="100" as="geometry" />
        </mxCell>
        <mxCell id="saPh2kpJ-CRyQlsd_s0C-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="80HF06romhgn_pdEOzrI-74" target="saPh2kpJ-CRyQlsd_s0C-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="saPh2kpJ-CRyQlsd_s0C-5" value="Получить данные по подключаемому блоку&lt;div&gt;По его названию и коду доступа&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="saPh2kpJ-CRyQlsd_s0C-4">
          <mxGeometry x="0.0187" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="saPh2kpJ-CRyQlsd_s0C-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="80HF06romhgn_pdEOzrI-74" target="80HF06romhgn_pdEOzrI-73">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3070" y="-680" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="saPh2kpJ-CRyQlsd_s0C-7" value="Сохранить данные по новой коробке" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="saPh2kpJ-CRyQlsd_s0C-6">
          <mxGeometry x="-0.0888" y="-1" relative="1" as="geometry">
            <mxPoint x="-1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="saPh2kpJ-CRyQlsd_s0C-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="80HF06romhgn_pdEOzrI-74" target="80HF06romhgn_pdEOzrI-73">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3100" y="-660" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="saPh2kpJ-CRyQlsd_s0C-10" value="Привязать новое устройство к коробке" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="saPh2kpJ-CRyQlsd_s0C-9">
          <mxGeometry x="-0.1435" y="2" relative="1" as="geometry">
            <mxPoint x="-71" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="80HF06romhgn_pdEOzrI-74" value="Сервис пользовательских профилей" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4485" y="-730" width="250" height="140" as="geometry" />
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.75;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="byD6cdz-UoJXL5TT6-PQ-1" target="80HF06romhgn_pdEOzrI-59" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-3" value="ASYNC получение и сохранений&lt;div&gt;событий об изменении целевого значения&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="byD6cdz-UoJXL5TT6-PQ-2" vertex="1" connectable="0">
          <mxGeometry x="-0.5284" y="4" relative="1" as="geometry">
            <mxPoint x="-33" y="-8" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-1" value="Сервис логирования операций&lt;div&gt;AuditLog&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4830" y="260" width="250" height="100" as="geometry" />
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-4" value="&lt;font style=&quot;font-size: 17px;&quot;&gt;Postgres&lt;/font&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.database;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="4998" y="330" width="130" height="130" as="geometry" />
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-5" value="1. Может отдать историю изменения значений датчика&lt;div&gt;2. Может отдать текущее значение датчика&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="4120" y="200" width="225" height="70" as="geometry" />
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-6" value="1. Может отдать историю изменений целевого значения с указанием того, кто его изменил&lt;div&gt;2. Может отдать текущее целевое значение&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="5120" y="255" width="230" height="90" as="geometry" />
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-39" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="byD6cdz-UoJXL5TT6-PQ-8" target="byD6cdz-UoJXL5TT6-PQ-37" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="3950" y="1060" as="targetPoint" />
            <mxPoint x="4000" y="1690" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="4160" y="1670" />
              <mxPoint x="4020" y="1670" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-40" value="SYNC IP адрес блока/дома&lt;div&gt;изменился&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="byD6cdz-UoJXL5TT6-PQ-39" vertex="1" connectable="0">
          <mxGeometry x="-0.1835" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-8" value="Блок&amp;nbsp;&lt;div&gt;управления&lt;/div&gt;" style="shape=cube;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;darkOpacity=0.05;darkOpacity2=0.1;" parent="1" vertex="1">
          <mxGeometry x="4140" y="1750" width="140" height="110" as="geometry" />
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-10" value="&lt;font style=&quot;font-size: 17px;&quot;&gt;Postgres&lt;/font&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.database;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="2970" y="-40" width="130" height="130" as="geometry" />
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-12" value="1. Хранит все зарегистрированные устройства и то как с ними нужно взаимодействовать" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="2850" y="-180" width="225" height="70" as="geometry" />
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="byD6cdz-UoJXL5TT6-PQ-16" target="byD6cdz-UoJXL5TT6-PQ-18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-16" value="UI" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4005" y="-1010" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-17" value="External User" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="1" vertex="1">
          <mxGeometry x="4054" y="-1110" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="byD6cdz-UoJXL5TT6-PQ-18" target="80HF06romhgn_pdEOzrI-74" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4338" y="-820" />
              <mxPoint x="4338" y="-710" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-22" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.158;exitY=1.015;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="byD6cdz-UoJXL5TT6-PQ-18" target="80HF06romhgn_pdEOzrI-73" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3980" y="-490" />
              <mxPoint x="3165" y="-490" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="byD6cdz-UoJXL5TT6-PQ-18" target="80HF06romhgn_pdEOzrI-71" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4020" y="-390" />
              <mxPoint x="3675" y="-390" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-24" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="byD6cdz-UoJXL5TT6-PQ-18" target="80HF06romhgn_pdEOzrI-68" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="byD6cdz-UoJXL5TT6-PQ-18" target="byD6cdz-UoJXL5TT6-PQ-1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4150" y="-490" />
              <mxPoint x="4955" y="-490" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-28" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="byD6cdz-UoJXL5TT6-PQ-18" target="byD6cdz-UoJXL5TT6-PQ-26" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4110" y="-360" />
              <mxPoint x="4545" y="-360" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-18" value="api-gateway (Kong)" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3940" y="-870" width="250" height="100" as="geometry" />
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="byD6cdz-UoJXL5TT6-PQ-26" target="80HF06romhgn_pdEOzrI-59" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4545" y="370" />
              <mxPoint x="4545" y="370" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-30" value="ASYNC События о выполнении действия&lt;div&gt;из сценария&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="byD6cdz-UoJXL5TT6-PQ-29" vertex="1" connectable="0">
          <mxGeometry x="0.2138" relative="1" as="geometry">
            <mxPoint y="-130" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-35" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.75;entryY=0;entryDx=0;entryDy=0;exitX=0.25;exitY=0;exitDx=0;exitDy=0;" parent="1" source="byD6cdz-UoJXL5TT6-PQ-26" target="80HF06romhgn_pdEOzrI-73" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4482" y="-220" />
              <mxPoint x="3228" y="-220" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-36" value="Проверка,&amp;nbsp;&lt;div&gt;что устройство зарегистрировано&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="byD6cdz-UoJXL5TT6-PQ-35" vertex="1" connectable="0">
          <mxGeometry x="-0.0801" y="-8" relative="1" as="geometry">
            <mxPoint x="392" y="8" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="saPh2kpJ-CRyQlsd_s0C-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="byD6cdz-UoJXL5TT6-PQ-26" target="80HF06romhgn_pdEOzrI-71">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4460" y="-160" />
              <mxPoint x="3760" y="-160" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-26" value="Сервис сценариев" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4420" y="-120" width="250" height="100" as="geometry" />
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-27" value="&lt;font style=&quot;font-size: 17px;&quot;&gt;Postgres&lt;/font&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.database;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="4610" y="-60" width="130" height="130" as="geometry" />
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-31" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=classic;startFill=1;endArrow=none;endFill=0;exitX=0.887;exitY=0.985;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="byD6cdz-UoJXL5TT6-PQ-37" target="byD6cdz-UoJXL5TT6-PQ-8" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="4250" y="1050" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="4387" y="1670" />
              <mxPoint x="4250" y="1670" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-32" value="ASYNC получения события&lt;div&gt;о выполнении действия из&lt;/div&gt;&lt;div&gt;сценария&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="byD6cdz-UoJXL5TT6-PQ-31" vertex="1" connectable="0">
          <mxGeometry x="0.2967" y="-2" relative="1" as="geometry">
            <mxPoint x="-5" y="-206" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-33" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="80HF06romhgn_pdEOzrI-73" target="byD6cdz-UoJXL5TT6-PQ-41" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="3410" y="600" as="targetPoint" />
            <Array as="points">
              <mxPoint x="3165" y="350" />
              <mxPoint x="3405" y="350" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-34" value="Проверка, что физическое устройство есть&lt;div&gt;и работает&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="byD6cdz-UoJXL5TT6-PQ-33" vertex="1" connectable="0">
          <mxGeometry x="-0.3867" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-42" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="byD6cdz-UoJXL5TT6-PQ-37" target="byD6cdz-UoJXL5TT6-PQ-41" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3690" y="980" />
              <mxPoint x="3690" y="980" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-46" value="IP адрес блока/дома&lt;div&gt;изменился&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="byD6cdz-UoJXL5TT6-PQ-42" vertex="1" connectable="0">
          <mxGeometry x="0.0423" y="4" relative="1" as="geometry">
            <mxPoint x="14" y="29" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-37" value="api-gateway (Kong)" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3970" y="959" width="470" height="100" as="geometry" />
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-38" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;" parent="1" source="byD6cdz-UoJXL5TT6-PQ-37" target="80HF06romhgn_pdEOzrI-59" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-41" value="Proxy IP адресов для домов/блоков" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3360" y="959" width="270" height="120" as="geometry" />
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-43" value="&lt;font style=&quot;font-size: 17px;&quot;&gt;Postgres&lt;/font&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.database;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="3570" y="1039" width="130" height="130" as="geometry" />
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-44" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0;entryDx=0;entryDy=45;entryPerimeter=0;" parent="1" source="byD6cdz-UoJXL5TT6-PQ-41" target="byD6cdz-UoJXL5TT6-PQ-8" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3470" y="1795" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-45" value="Запросы от сервиса регистрации устройств&lt;div&gt;и&lt;/div&gt;&lt;div&gt;от сервиса управления&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="byD6cdz-UoJXL5TT6-PQ-44" vertex="1" connectable="0">
          <mxGeometry x="-0.3857" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-47" value="&lt;h3&gt;&lt;b&gt;Функциональные требования&lt;/b&gt;&lt;/h3&gt;&lt;div&gt;&lt;b&gt;IoT устройства&lt;/b&gt;&lt;/div&gt;&lt;div&gt;1. У устройств есть два значения: целевое значение и текущее значение. Целевое значение - это то к чему должно придти текущее значение. Как это происходит - нас не интересует, считаем, что устройство идеально работает, диагностика не нужна (а если нужна, то выезжает специалист в поле).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Пример:&lt;/div&gt;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&lt;div&gt;Блок управления температурой.&amp;nbsp;&lt;/div&gt;&lt;div&gt;Целевое значение - это температура, которую нужно поддерживать, текущее значение - это текущая температура. Блок управления температурой мониторит текущее значение и пытается довести его до целевого значения. Таким образом текущее значение будет со временем приближаться к целевому значению.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Ворота.&lt;/div&gt;&lt;div&gt;Целевое значение - ворота открыты или закрыты.&amp;nbsp; Текущее значение - ворота открыты/закрыты/ открываются/закрываются. Допустим ворота закрыты. Пользователь меняет целевое значение на ворота закрыты. Блок управления начинает открывать ворота и переводит текущее значение в открываются, после того как ворота откроются полностью, блок управления переводит текущее значение в открыты. Тут аналогичная ситуация: текущее значение со временем приближается к целевому значению.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Переключатель света.&lt;/div&gt;&lt;div&gt;Целевое значение - свет включен или выключен. Текущее значение - свет включен или выключен. Тут другая ситуация: текущее значение меняется сразу же с изменением целевого значения,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2. Устройству можно задать новое целевое значение&lt;/div&gt;&lt;div&gt;3. Устройство отдаёт своё целевое значение и своё текущее значение&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;Блок управления&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;1. Работает напрямую с IoT устройствами, может задавать им целевые значения, может получать установленное целевое значение и текущее значение, (опционально) может отключать/включать устройства (некоторые можно реально физически отключить, остальные виртуально, т.е. отключить управление ими)&lt;/div&gt;&lt;div&gt;2. Подключается к WiFi пользователя и знает внешний IP&lt;/div&gt;&lt;div&gt;3. Может взаимодействовать с нашей системой через api-gateway при этом используется простая авторизация по Bearer token.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;Профиль пользователя/домов/устройств:&lt;/b&gt;&lt;/p&gt;&lt;p&gt;1. При установке умных блоков в дом, администратор регистрирует&amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;в нашей системе&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;дом и его пред-установленные устройства&lt;/span&gt;&lt;/p&gt;&lt;p&gt;2. Пользователь может зарегистрироваться, при этом он указывает в каком доме он живёт&lt;/p&gt;&lt;p&gt;3. Пользователь работает с системой только после авторизации (получения JWT токена)&lt;/p&gt;&lt;p&gt;4. Пользователь может подключить дополнительные устройства в своём доме&lt;/p&gt;&lt;p&gt;5. Пользователь может создать сценарии работы для устройств&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;Управление:&lt;/b&gt;&lt;/p&gt;&lt;p&gt;1. Пользователь может изменять целевое значение устройства&lt;/p&gt;&lt;p&gt;2. Пользователь может включать/отключать устройства&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;Мониторинг:&lt;/b&gt;&lt;/p&gt;&lt;p&gt;1. Пользователь может просматривать историю выполненных действий над устройством&lt;/p&gt;&lt;p&gt;2. Пользователь может просматривать историю изменений текущих значений устройств&lt;/p&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="3840" y="-2230" width="570" height="1040" as="geometry" />
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-48" value="OAuth2,&lt;div&gt;JWT&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;strokeColor=default;" parent="1" vertex="1">
          <mxGeometry x="4120" y="-860" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-49" value="Mongo" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" parent="1" vertex="1">
          <mxGeometry x="4690" y="-645" width="100" height="100" as="geometry" />
        </mxCell>
        <mxCell id="byD6cdz-UoJXL5TT6-PQ-50" value="Basic Auth" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;strokeColor=default;" parent="1" vertex="1">
          <mxGeometry x="4310" y="970" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="saPh2kpJ-CRyQlsd_s0C-1" value="&lt;h3&gt;&lt;b&gt;Пользователи и наша экосистема&lt;br&gt;&lt;/b&gt;&lt;/h3&gt;&lt;div&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;Мы производим блоки управления умным домом (коробки), на них есть название коробки и код доступа. Когда мы выпускаем коробку, то заносим название новой коробки и код доступа к ней в наш реестр выпущенных блоков управления умным домом (некий сервис).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Пользователь регистрируется в нашей экосистеме и попадает в свой профиль. После этого он может привязать к своему профилю блок управления умным домом (нашу коробку).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Пользователь покупает нашу коробку, далее заходит в свой профиль и добавляет к себе в профиль нашу коробку, используя название коробки и код доступа для неё. Далее он может поменять код доступа коробки, поменять название коробки.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Таким образом у пользователя есть профиль, в который он может подключить одну или более наших коробок.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Далее он может подключить к своей коробке любое поддерживаемое нами устройство.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Наша коробка знает IP адреса нашего api-gateway, поэтому может взаимодействовать с нами. При первом подключении она отсылает нам внешний IP адрес пользовательской сети. После этого и мы знаем как подключиться к ней. Если внешний IP адрес пользовательской сети меняется, то коробка также сообщает нам об этом. Данную информацию обрабатывает сервис &quot;&lt;span style=&quot;text-align: center; background-color: initial;&quot;&gt;Proxy IP адресов для домов/блоков&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&quot;, также данный сервис выполняет health check известных ему коробок&lt;/span&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="4540" y="-1530" width="560" height="410" as="geometry" />
        </mxCell>
        <mxCell id="saPh2kpJ-CRyQlsd_s0C-2" value="Сервис реестра поступивших в продажу блоков управления" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="5128" y="-710" width="250" height="100" as="geometry" />
        </mxCell>
        <mxCell id="saPh2kpJ-CRyQlsd_s0C-3" value="&lt;font style=&quot;font-size: 17px;&quot;&gt;Postgres&lt;/font&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.database;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="5330" y="-660" width="130" height="130" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
